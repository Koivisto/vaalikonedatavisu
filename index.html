<!DOCTYPE html>
<head>
<title>NULL</title>
<!--<link rel="shortcut icon" href="" />
<meta name="author" content="" />-->
<meta charset="utf-8"/>
<style type="text/css">
@-ms-viewport{
	width: device-width;
}
body{
	margin: 0px 0px 0px 0px; /*top right bottom left*/
	max-width: 1800px ;
	margin-left: auto;
	margin-right: auto;
	position: relative;
}
article{
	background: #FF9D76;
}
#explanations{
	color:#000;
	background-color: #FFF;

}

/*svg elements styles, ATTENTION! the syntax is different from pure html elements (color=fill etc.)*/
svg{
	background-color: #7D9886;
}
text{
	fill: #FFFFFF;
}
circle {
	stroke: #006600;
	fill  : #00cc00;
}

@media only screen and (max-width: 999px){

}

</style>
<!--jQuery initializing-->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
<!--D3.js library initializing-->
<script src="http://d3js.org/d3.v3.min.js"></script>
<!--Other javascript for the page-->
<script type="text/javascript">
</script>
</head>

<body>
	<article>

<header>
	<h1>Otsikko jos ois</h1>
	<p>Tähän tulee jotain metajuttuja, tekijöitä ja sellasia</p>
</header>

<div id="explanations" style="visibility: hidden; position: absolute;">selite</div>

<div id="visualizationDiv">
	<svg id="visualizationSvg"></svg>
</div>
<!--Visualization logic-->
<script type="text/javascript" charset="utf-8">

var width = $(document).width();
var height = getHeight();

function getHeight(){
	if( $(window).height() > 1000 ){return 1000;}
	else{return $(window).height();}
};

var svg = d3.select("#visualizationSvg");
svg
.attr("width", width)
.attr("height", height)

//Data begins
//d3.csv("testidata.csv", function(d){
d3.csv("kirkasinfo_data.csv", function(d){

//Visualization resizing starts
function redraw() {
	//Removing old elements
	svg.selectAll("circle").remove();
	svg.selectAll("text").remove();

width = $("#visualizationDiv").width();
var height = getHeight();
svg
.attr("width", width)
.attr("height", height)

var person = svg.append("g")
var isClicked = false;
var selectedCandidates = [];
//How to add candidate: selectedCandidates[selectedCandidates.length] = candidate;

var previousCircle = null;
svg.selectAll("circle")
	.data(d)
	.enter()
		.append("circle")
		.attr("cx", function(d){return width/2+((+d.scorex)*(width/6));})
		.attr("cy", function(d){return height/2+((+d.scorey)*(height/6));})
		.attr("r", 10)
		/*It is possible to click candidate, so the info will keep showing without mouseover, but resets if mouseenter is called for another candidate*/
		.on('click', function(d){
			var candidate = {element:d3.select(this), 
							name: d.name, 
							party: d.party, 
							scorex: +d.scorex, 
							scorey: +d.scorey};
			displayInfo(candidate.element, candidate.name, candidate.party, candidate.scorex, candidate.scorey);
			selectedCandidates[selectedCandidates.length] = candidate;
			isClicked = !isClicked;
			previousCircle = d3.select(this);
			displayInfoOnSelectedCandidates();
			})
		.on('mouseenter', function(d){
			if(previousCircle != null && isClicked){dontDisplayInfo(previousCircle);isClicked = !isClicked;}
			displayInfo(d3.select(this), d.name, d.party, +d.scorex, +d.scorey);
			displayInfoOnSelectedCandidates();
			})
		.on('mouseleave', function(d){
			if(!isClicked){dontDisplayInfo(d3.select(this))};
			displayInfoOnSelectedCandidates();
			})
		.on('touchstart', function(d){
			displayInfo(d3.select(this), d.name, d.party, +d.scorex, +d.scorey);
			displayInfoOnSelectedCandidates();
			})
		.on('touchend', function(d){
			if(!isClicked){dontDisplayInfo(d3.select(this))};
			displayInfoOnSelectedCandidates();
			})
		.style("fill", function(d){
			switch(d.party){
				case "KOK":  return "blue";
				case "RKP":  return "yellow";
				case "PS":   return "grey";
				case "KESK": return "green";
				case "VIHR": return "GnBu";
				case "VAS":  return "#FF0700";
				case "SKP":  return "#55110F";
				case "KD":   return "#9333C0";
				case "IP":   return "#5596CC";
				case "PIR":  return "black";
				case "M11":  return "white";
				case "SDP":  return "#930C08";
				default: 	 return "red";
			}
		});



function displayInfo(personCircle, name, party, scorex, scorey){
	personCircle
		.transition()
		.duration(300)
		.attr("r", 30)
		.style({opacity:'1.0'});

	//html text
	var infoString = name+"<br>"+party+"<br>"+scorex+" "+scorey;
	
	d3.select("#explanations")
		.style("visibility", "")
		.style("display", "block");

	var infoDiv = document.createElement('div');
	document.getElementById('explanations').appendChild(infoDiv);
	infoDiv.id = name;
	//d3.select("#"+name)
	//	.style("visibility", "")
	//	.style("display", "block")
	//	.style("position", "absolute");
	infoDiv.innerHTML = infoString;
	infoDiv.style.position = "absolute";
	infoDiv.style.left = parseInt(personCircle.attr("cx") + svg.offsetLeft) + "px";
	infoDiv.style.top = parseInt(personCircle.attr("cy") + svg.offsetTop) + "px";

	return infoString;

}

function displayInfoOnSelectedCandidates(){
	for (var i = selectedCandidates.length - 1; i >= 0; i--) {
		displayInfo(selectedCandidates[i].element,
					selectedCandidates[i].name, 
					selectedCandidates[i].party,
					selectedCandidates[i].scorex, 
					selectedCandidates[i].scorey);
	};
}

function dontDisplayInfo(personCircle){
	personCircle
		.transition()
		.duration(300)
		.attr("r", 10)
		.style({opacity:'0.4'});

	svg.selectAll("text").remove();
	d3.select("#explanations")
		.style("visibility", "none")
		.style("display", "none");
}


displayInfoOnSelectedCandidates;
}//Visualization resizing ends
d3.select(window).on('resize', redraw); 

redraw();
});//Data ends


</script>

<p>Visualisointi tossa päällä. Tähän tulee tiukkaa analyysiä</p>

	</article>
</body>
</html>