<!DOCTYPE html>
<head>
<title>NULL</title>
<!--<link rel="shortcut icon" href="" />
<meta name="author" content="" />-->
<meta charset="utf-8"/>
<style type="text/css">
@-ms-viewport{
	width: device-width;
}
body{
	margin: 0px 0px 0px 0px; /*top right bottom left*/
	max-width: 1800px ;
	margin-left: auto;
	margin-right: auto;
	position: relative;
}
article{
	background: #FF9D76;
}
#explanation{
	color:#000;
	background-color: #FFF;

}

/*svg elements styles, ATTENTION! the syntax is different from pure html elements (color=fill etc.)*/
svg{
	background-color: #7D9886;
}
text{
	fill: #FFFFFF;
}
circle {
	stroke: #006600;
	fill  : #00cc00;
}

@media only screen and (max-width: 999px){

}

</style>
<!--jQuery initializing-->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
<!--D3.js library initializing-->
<script src="http://d3js.org/d3.v3.min.js"></script>
<!--Other javascript for the page-->
<script type="text/javascript">
</script>
</head>

<body>
	<article>

<header>
	<h1>Otsikko jos ois</h1>
	<p>Tähän tulee jotain metajuttuja, tekijöitä ja sellasia</p>
</header>

<div id="explanation" style="visibility: hidden; position: absolute;">selite</div>

<div id="visualizationDiv">
	<svg id="visualizationSvg"></svg>
</div>
<!--Visualization logic-->
<script type="text/javascript" charset="utf-8">

var width = $(document).width();
var height = getHeight();

function getHeight(){
	if( $(window).height() > 1000 ){return 1000;}
	else{return $(window).height();}
};

var svg = d3.select("#visualizationSvg");
svg
.attr("width", width)
.attr("height", height)

//Visualization resizing starts
function redraw() {
	//Removing old elements
	svg.selectAll("circle").remove();
	svg.selectAll("text").remove();

width = $("#visualizationDiv").width();
var height = getHeight();
svg
.attr("width", width)
.attr("height", height)

//Data begins
d3.csv("testidata.csv", function(d){

var person = svg.append("g")

svg.selectAll("circle")
	.data(d)
	.enter()
		.append("circle")
		.attr("cx", function(d){return width/2+((+d.scorex)*(width/6));})
		.attr("cy", function(d){return height/2+((+d.scorey)*(height/6));})
		.attr("r", 8)
		.on('mouseenter', function(d){
			displayInfo(d3.select(this), d.name, d.party, +d.scorex, +d.scorey);
			})
		.on('mouseleave', function(d){
			dontDisplayInfo(d3.select(this));
			})
		.on('touchstart', function(d){
			displayInfo(d3.select(this), d.name, d.party, +d.scorex, +d.scorey);
			})
		.on('touchend', function(d){
			dontDisplayInfo(d3.select(this));
			})
		.style("fill", function(d){
			switch(d.party){
				case "KOK":  return "blue";
				case "RKP":  return "yellow";
				case "PS":   return "grey";
				case "KESK": return "green";
				case "VIHR": return "GnBu";
				case "VAS":  return "#FF0700";
				case "SKP":  return "#55110F";
				case "KD":   return "#9333C0";
				case "IP":   return "#5596CC";
				case "PIR":  return "black";
				case "M11":  return "white";
				case "SDP":  return "#930C08";
				default: 	 return "red";
			}
		});

function displayInfo(personCircle, name, party, scorex, scorey){
personCircle
	.transition()
	.duration(1000)
	.delay(100)
	.attr("r", 30)
	.style({opacity:'1.0'});

svg.selectAll("text")
	.data(d)
	.enter()
	.append("svg:text")

		//svg text
		.attr("x", width/2)
		.attr("y", height/2)
		.text(function(d){
			var infoString = name+"<br>"+party+"<br>"+scorex+" "+scorey;

		//html text
			d3.select("#explanation")
				.style("visibility", "")
				.style("display", "block");
			//Gets the mouse location
			document.onmousemove = getMouseCordinates;
			var xCord, yCord = 0
			function getMouseCordinates(e) {
				xCord = e.pageX
				yCord = e.pageY
				//normal js here
				document.getElementById('explanation').innerHTML = infoString;
				document.getElementById('explanation').style.left = +xCord+ 10+'px';
			    document.getElementById('explanation').style.top = +yCord+ 10+'px';
			}

			return infoString;
		});
}

function dontDisplayInfo(personCircle){
personCircle
	.transition()
	.duration(1000)
	.delay(100)
	.attr("r", 8)
	.style({opacity:'0.4'});

	svg.selectAll("text").remove();
	d3.select("#explanation")
		.style("visibility", "none")
		.style("display", "none");
}

});//Data ends

}//Visualization resizing ends
d3.select(window).on('resize', redraw); 
redraw();


</script>

<p>Visualisointi tossa päällä. Tähän tulee tiukkaa analyysiä</p>

	</article>
</body>
</html>